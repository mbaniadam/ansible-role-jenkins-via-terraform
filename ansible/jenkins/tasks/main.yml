---
# tasks file for jenkins
- name: "install gpg required by apt_key"
  apt:
    name: gnupg
    state: present

- name: "add jenkins key"
  apt_key:
    state: present
    url: "{{ jenkins_key_url }}"

- name: "add repository"
  apt_repository: 
    filename: "{{ jenkins_repo.name }}"
    repo: "{{ jenkins_repo.url }}"
    state: present
    update_cache: yes

- name: "Install Jenkins and Java"
  apt:
    name: "{{ item.value.name }}"
    state: present
  loop:
    "{{lookup('dict', packages) }}"

- name: "daemon-reload"
  systemd:
    daemon_reload: true
    
- name: "Starting jenkins" 
  service:
    name: "jenkins"
    state: started
    enabled: yes

- name: "Get Service Status"
  systemd:
    name: jenkins
  register: jenkins_state

- name: Debug
  debug:
    var: jenkins_state.status.ActiveState


- name: "Disable jenkins setup wizard"
  lineinfile:
    path: "{{ jenkins_config_file }}"
    line: JAVA_ARGS="-Djenkins.install.runSetupWizard=false"


